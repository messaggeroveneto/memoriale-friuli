<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Memoriale ‚Äì Terremoto del Friuli (1976)</title>
<style>
  :root{
    --bg:#ffffff;
    --text:#12131a;
    --muted:#5a6072;
    --card:#ffffff;
    --line:rgba(20,22,35,.12);
  }
  html,body{height:100%;}
  body{
    margin:0;
    color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    overflow:hidden;
    background: var(--bg);
    /* pattern leggero di omini (SVG inline, ripetuto) */
    background-image:
      url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Cg fill='none' stroke='%2312131a' stroke-opacity='.07' stroke-width='2'%3E%3Ccircle cx='30' cy='28' r='8'/%3E%3Cpath d='M18 56c2-12 22-12 24 0'/%3E%3Cpath d='M30 56v18'/%3E%3Cpath d='M30 74l-10 16'/%3E%3Cpath d='M30 74l10 16'/%3E%3Ccircle cx='90' cy='74' r='8'/%3E%3Cpath d='M78 102c2-12 22-12 24 0'/%3E%3Cpath d='M90 102v18'/%3E%3C/g%3E%3C/svg%3E");
    background-size: 140px 140px;
  }

  .wrap{
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px;
  }

  .panel{
    width:min(980px, 100%);
    background:rgba(255,255,255,.82);
    backdrop-filter: blur(6px);
    border:1px solid var(--line);
    border-radius:22px;
    box-shadow: 0 18px 70px rgba(0,0,0,.10);
    padding:18px;
    opacity:1;
    transform: translateY(0);
    transition: opacity 420ms ease, transform 420ms ease;
  }

  .fade-out .panel{
    opacity:0;
    transform: translateY(8px);
  }

  .topbar{
    display:flex;
    justify-content:space-between;
    align-items:baseline;
    gap:12px;
    padding:6px 6px 14px;
  }
  .title{
    font-weight:650;
    letter-spacing:.2px;
    font-size:14px;
    color:rgba(18,19,26,.72);
  }
  .counter{
    font-size:12px;
    color:rgba(18,19,26,.60);
  }

  .grid{
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap:10px 16px;
    padding:6px;
  }
  @media (min-width: 840px){
    .grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
  }

  .item{
    border:1px solid var(--line);
    border-radius:16px;
    padding:12px 12px 10px;
    background:rgba(255,255,255,.92);
  }
  .name{
    font-weight:650;
    line-height:1.15;
    font-size:16px;
  }
  .place{
    margin-top:6px;
    color:var(--muted);
    font-size:12px;
  }

  .hint{
    position:fixed;
    left:14px;
    right:14px;
    bottom:12px;
    text-align:center;
    color:rgba(18,19,26,.58);
    font-size:12px;
    pointer-events:none;
  }
</style>
</head>
<body>

<div class="wrap" id="wrap">
  <div class="panel" id="panel">
    <div class="topbar">
      <div class="title">Memoriale ‚Äì Vittime del terremoto del Friuli (1976)</div>
      <div class="counter" id="counter">‚Äî</div>
    </div>
    <div class="grid" id="grid"></div>
  </div>
</div>

<div class="hint" id="hint">Scroll ‚Ä¢ Frecce ‚Üë ‚Üì ‚Ä¢ Touch swipe</div>

<script>
  const wrap = document.getElementById("wrap");
  const grid = document.getElementById("grid");
  const counter = document.getElementById("counter");

  let DATA = [];
  let page = 0;

  // quanti nomi per ‚Äúpagina‚Äù
  const PAGE_SIZE = 12;

  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

  function render(){
    const totalPages = Math.max(1, Math.ceil(DATA.length / PAGE_SIZE));
    page = clamp(page, 0, totalPages - 1);

    const start = page * PAGE_SIZE;
    const slice = DATA.slice(start, start + PAGE_SIZE);

    grid.innerHTML = slice.map(r => `
      <div class="item">
        <div class="name">${escapeHtml(r.n || "‚Äî")}</div>
        <div class="place">${r.l ? "üìç " + escapeHtml(r.l) : ""}</div>
      </div>
    `).join("");

    counter.textContent = `Pagina ${page+1} / ${totalPages} ‚Ä¢ Nomi ${start+1}-${Math.min(start+PAGE_SIZE, DATA.length)} / ${DATA.length}`;
  }

  function escapeHtml(s){
    return (s ?? "").replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[c]));
  }

  function step(delta){
    const totalPages = Math.max(1, Math.ceil(DATA.length / PAGE_SIZE));
    const next = clamp(page + delta, 0, totalPages - 1);
    if(next === page) return;

    wrap.classList.add("fade-out");
    setTimeout(() => {
      page = next;
      render();
      requestAnimationFrame(() => wrap.classList.remove("fade-out"));
    }, 220);
  }

  // Wheel: una pagina per scatto
  let wheelLock = false;
  window.addEventListener("wheel", (e) => {
    e.preventDefault();
    if (wheelLock) return;
    wheelLock = true;
    step(e.deltaY > 0 ? 1 : -1);
    setTimeout(() => wheelLock = false, 280);
  }, { passive:false });

  // Keyboard
  window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowDown" || e.key === "PageDown" || e.key === " ") { e.preventDefault(); step(1); }
    if (e.key === "ArrowUp" || e.key === "PageUp") { e.preventDefault(); step(-1); }
    if (e.key === "Home") { e.preventDefault(); page=0; render(); }
    if (e.key === "End") { e.preventDefault(); page=999999; render(); }
  });

  // Touch swipe
  let startY = null;
  window.addEventListener("touchstart", (e) => {
    if (!e.touches || !e.touches.length) return;
    startY = e.touches[0].clientY;
  }, { passive:true });

  window.addEventListener("touchend", (e) => {
    if (startY == null) return;
    const endY = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientY : startY;
    const dy = endY - startY;
    if (Math.abs(dy) > 30) step(dy < 0 ? 1 : -1);
    startY = null;
  }, { passive:true });

  function parseCSV(text){
    const lines = text.trim().split(/\r?\n/);
    const sep = lines[0].includes(";") ? ";" : ",";
    const headers = lines.shift().split(sep).map(h => h.trim());
    const iC = headers.findIndex(h => h.toLowerCase() === "cognome");
    const iN = headers.findIndex(h => h.toLowerCase() === "nome");
    const iL = headers.findIndex(h => h.toLowerCase() === "luogo");

    const out = [];
    for(const line of lines){
      if(!line.trim()) continue;
      const cells = line.split(sep).map(s => s.trim());
      const nome = cells[iN] || "";
      const cognome = cells[iC] || "";
      const luogo = cells[iL] || "";
      const full = (nome + " " + cognome).trim();
      if(full) out.push({ n: full, l: luogo });
    }
    out.sort((a,b) => a.n.localeCompare(b.n, "it"));
    return out;
  }

  async function load(){
    // NB: nel tuo repo il file si chiama Morti_Terremoto.csv
    const res = await fetch("Morti_Terremoto.csv", { cache:"no-store" });
    const buf = await res.arrayBuffer();
    let text;
    try { text = new TextDecoder("iso-8859-1").decode(buf); }
    catch { text = new TextDecoder("utf-8").decode(buf); }
    DATA = parseCSV(text);
    page = 0;
    render();
  }

  load().catch(err => {
    console.error(err);
    grid.innerHTML = `<div class="item"><div class="name">Errore nel caricamento</div><div class="place">Controlla che Morti_Terremoto.csv sia nella stessa cartella di index.html</div></div>`;
    counter.textContent = "";
  });
</script>

</body>
</html>
